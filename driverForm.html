<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Driver Location Update</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f9f9f9; max-width: 480px; margin: auto; }
    .card { background: #fff; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    #map { height: 280px; width: 100%; border-radius: 8px; background: #e9e9e9; margin-bottom: 12px; }
    label, select, input, button { display: block; width: 100%; }
    select, input { padding: 8px; margin: 8px 0; border: 1px solid #ccc; border-radius: 4px; }
    input[readonly] { background: #f0f0f0; }
    button { padding: 10px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .message { text-align: center; margin: 8px 0; }
    .error { color: #dc3545; }
    .success { color: #28a745; }
  </style>
</head>
<body>
  <h2>Driver Location Update</h2>  <div class="card">
    <label for="vehicleSelect">Select Vehicle</label>
    <select id="vehicleSelect" required>
      <option value="">-- Select Your Vehicle --</option>
      <option value="BAH1996">BAH1996 (Toyota Camry)</option>
      <option value="XYZ7890">XYZ7890 (Honda Accord)</option>
      <option value="DEF4567">DEF4567 (Ford Transit)</option>
    </select>
    <div><strong>Type:</strong> <span id="displayType">-</span></div>
    <div><strong>Color:</strong> <span id="displayColor">-</span></div>
    <div><strong>Plate:</strong> <span id="displayPlate">-</span></div>
    <div><strong>Phone:</strong> <span id="displayPhone">-</span></div>
  </div>  <div class="card">
    <h3>Current Location</h3>
    <div id="map">Loading map...</div>
    <button id="refreshBtn">Refresh Location</button>
    <div id="accuracy" class="message"></div>
    <label for="locationName">Nearest Place</label>
    <input type="text" id="locationName" readonly placeholder="Fetching place name..." />
  </div>  <div id="loading" class="message">Processing...</div>
  <div id="error" class="message error"></div>
  <div id="success" class="message success"></div>  <form id="locationForm">
    <input type="hidden" name="Location" id="location">
    <input type="hidden" name="Coordinates" id="coords">
    <input type="hidden" name="Vehicle_Type" id="type">
    <input type="hidden" name="Vehicle_Color" id="color">
    <input type="hidden" name="Vehicle_Registration" id="plate">
    <input type="hidden" name="Driver_Phone" id="phone">
    <button type="submit" id="submitBtn" disabled>Send Location</button>
  </form>  <script>
    const vehicleDB = {
      "BAH1996": { type: "Toyota Camry", color: "White", phone: "+1-555-1234" },
      "XYZ7890": { type: "Honda Accord", color: "Black", phone: "+1-555-9876" },
      "DEF4567": { type: "Ford Transit", color: "Blue", phone: "+1-555-4567" }
    };
    const el = id => document.getElementById(id);
    let map, marker, geocoder;

    function init() {
      el('vehicleSelect').addEventListener('change', onVehicleChange);
      el('refreshBtn').addEventListener('click', e => { e.preventDefault(); locate(); });
      el('locationForm').addEventListener('submit', submitLocation);
      geocoder = new google.maps.Geocoder();
      locate();
    }

    function onVehicleChange() {
      const key = this.value;
      if (vehicleDB[key]) {
        const v = vehicleDB[key];
        el('displayType').textContent = v.type;
        el('displayColor').textContent = v.color;
        el('displayPlate').textContent = key;
        el('displayPhone').textContent = v.phone;
        el('type').value = v.type;
        el('color').value = v.color;
        el('plate').value = key;
        el('phone').value = v.phone;
        checkReady();
      }
    }

    function locate() {
      showLoading(true); clearMsg();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => setPosition(pos.coords),
          err => showError('GPS failed. Please try again.'),
          { timeout:15000, enableHighAccuracy:true }
        );
      } else showError('Geolocation not supported.');
    }

    function setPosition({ latitude, longitude, accuracy }) {
      showLoading(false);
      const lat = parseFloat(latitude.toFixed(6));
      const lng = parseFloat(longitude.toFixed(6));
      const coords = `${lat},${lng}`;
      el('coords').value = coords;
      el('accuracy').textContent = `Accuracy: Â±${Math.round(accuracy)}m`;

      if (!map) {
        map = new google.maps.Map(el('map'), { center: {lat, lng}, zoom: 15 });
        marker = new google.maps.Marker({ map });
      }
      const pos = { lat, lng };
      map.setCenter(pos); marker.setPosition(pos);

      reverseGeocode(pos);
      checkReady();
    }

    function reverseGeocode(latlng) {
      geocoder.geocode({ location: latlng }, (results, status) => {
        let place = latlng.lat + ',' + latlng.lng;
        if (status === 'OK' && results[0]) place = results[0].formatted_address;
        el('locationName').value = place;
        el('location').value = place;
      });
    }

    function checkReady() {
      if (el('coords').value && el('vehicleSelect').value) el('submitBtn').disabled = false;
    }

    function submitLocation(e) {
      e.preventDefault(); showLoading(true); clearMsg();
      const data = new URLSearchParams(new FormData(el('locationForm'))).toString();
      fetch('https://script.google.com/macros/s/AKfycbxy3eUjHDcOCr-cEpihTTrTnixw_6rE2B_w_25UxK2SnTXPYvT0f44jM3Ud1A2yEXKB_A/exec?' + data)
        .then(() => showMsg('success', 'Location sent.'))
        .catch(() => showMsg('error', 'Submit failed.'))
        .finally(() => showLoading(false));
    }

    function showLoading(on) { el('loading').style.display = on ? 'block' : 'none'; }
    function clearMsg() { el('error').textContent=''; el('success').textContent=''; }
    function showMsg(type, msg) { el(type).textContent = msg; }
    function showError(msg) { showMsg('error', msg); }

    function loadMaps() {
      const s = document.createElement('script');
      s.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyDRdnvGw7epuDJjgBnpv0-FEuSQ6J-fyNY&libraries=places&callback=init';
      s.async = true; s.defer = true;
      document.head.appendChild(s);
    }
    window.onload = loadMaps;
  </script></body>
</html>
